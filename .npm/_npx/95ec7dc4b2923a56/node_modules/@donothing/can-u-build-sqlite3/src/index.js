const config = require('../knexfile').development
const knex = require('knex')
const Path = require('path/posix')

const main = async () => {
  let db
  try {
    db = knex(config)
    await db.migrate.latest()
    await db.seed.run()
    const examples = await db('examples').select('*')
    if (
      examples.length !== 2 ||
      examples[1].description !== 'This is the second example'
    ) {
      throw new Error(`Something went wrong`)
    }

    process.stdout.write(`Everything looks good!\n`)
  } finally {
    db.destroy()
  }
}

module.exports = main
